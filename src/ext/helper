#!/bin/bash -ex

function bootstrap()
{
  ./autogen.sh
  cd build
  CC="ccache clang" CFLAGS="-fsanitize=address -g -Wno-c99-extensions \
    -Wno-declaration-after-statement -Wno-missing-prototypes \
    -Wno-gcc-compat -Wno-long-long -Wno-comment -Wno-variadic-macros \
    -Werror=incompatible-function-pointer-types" \
    ../configure --prefix $PWD/../local \
    --with-video=sdl --with-opengl --enable-opengl-by-default \
    --enable-monitorbreakpoints --enable-monitorprofile --enable-monitortrace \
    --enable-seriosound \
    --with-sound=sdlmixer --with-ext --with-ext-lua
  cd -
}

install()
{
  VERBOSE=1 SHELL='sh -x' make V=1 -C build -j 4 install
}

$1
